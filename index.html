// --- Three.js 基本設定 ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- 1. 中3理科：天体（星空）の作成 ---
// 巨大な球体の内側に星のテクスチャを貼る、または点（Points）で表現します
function createStarfield() {
    const vertices = [];
    for (let i = 0; i < 5000; i++) {
        const x = THREE.MathUtils.randFloatSpread(2000);
        const y = THREE.MathUtils.randFloatSpread(2000);
        const z = THREE.MathUtils.randFloatSpread(2000);
        vertices.push(x, y, z);
    }
    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    const material = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.7 });
    const stars = new THREE.Points(geometry, material);
    scene.add(stars);
}
createStarfield();

// --- 2. キャラクター（アバター）の管理 ---
const avatars = {}; // 他の参加者を保存するオブジェクト
const myAvatar = new THREE.Mesh(
    new THREE.BoxGeometry(1, 2, 1),
    new THREE.MeshBasicMaterial({ color: 0x00ff00 })
);
scene.add(myAvatar);

// --- 3. リアルタイム同期 (Socket.io) ---
const socket = io(); // サーバーへ接続

// 自分の移動をサーバーに伝える
function updateMovement() {
    // キー入力に応じて myAvatar.position を変更
    // ... (移動ロジック)
    socket.emit('move', {
        x: myAvatar.position.x,
        y: myAvatar.position.y,
        z: myAvatar.position.z
    });
}

// 他の人の移動を受け取る
socket.on('user_moved', (data) => {
    if (!avatars[data.id]) {
        // 新しいユーザーならアバターを作成
        avatars[data.id] = new THREE.Mesh(
            new THREE.BoxGeometry(1, 2, 1),
            new THREE.MeshBasicMaterial({ color: 0xff0000 })
        );
        scene.add(avatars[data.id]);
    }
    // 位置を更新
    avatars[data.id].position.set(data.x, data.y, data.z);
});

// ループ処理
function animate() {
    requestAnimationFrame(animate);
    updateMovement();
    renderer.render(scene, camera);
}
animate();

  </a-scene>
</body>
</html>
